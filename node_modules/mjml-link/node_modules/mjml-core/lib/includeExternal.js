'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var includes = /<mj-include\s+path=['"](.*\.mjml)['"]\s*(\/>|>\s*<\/mj-include>)/g;

var getContent = function getContent(input) {
  return input.replace(/<mjml>[\n\s\t]+<mj-body>[\n\s\t]+<mj-container>/, '').replace(/<\/mj-container>[\n\s\t]+<\/mj-body>[\n\s\t]+<\/mjml>/, '');
};

exports.default = function (mjml) {
  return mjml.replace(includes, function (_, path) {
    var mjmlExtension = function mjmlExtension(file) {
      return file.trim().match(/.mjml$/) && file || file + '.mjml';
    };

    var template = _fs2.default.readFileSync(mjmlExtension(path), 'utf8');
    var content = getContent(template);

    if (!content) {
      throw new Error('Error while parsing file: ' + path);
    }

    return content;
  });
};